random_id.sa: Refreshing state... [id=fgXpjw]
azurerm_resource_group.hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks]
module.onprem_simulation.azurerm_resource_group.onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks]
module.onprem_simulation.azurerm_virtual_network.onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks]
module.observability.azurerm_network_watcher.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkWatchers/nw-uks]
module.spoke2.azurerm_network_security_group.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke2-uks]
module.workload_webapp_spoke2.azurerm_service_plan.app: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/serverFarms/asp-app-spoke2-obs-7e05e98f]
module.spoke1.azurerm_network_security_group.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke1-uks]
module.spoke2.azurerm_virtual_network.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks]
module.spoke1.azurerm_virtual_network.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks]
module.networking.azurerm_virtual_network.hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks]
module.security.azurerm_firewall_policy.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/firewallPolicies/afwp-uks-premium]
module.networking.azurerm_network_security_group.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-agw-uks]
module.security.azurerm_public_ip.agw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-agw-uks-7e05e98f]
module.security.azurerm_public_ip.fw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks]
module.observability.azurerm_storage_account.flowlogs: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Storage/storageAccounts/stflowlogs7e05e98f]
module.observability.azurerm_log_analytics_workspace.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f]
module.networking.azurerm_subnet.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/snet-agw-uks]
module.networking.azurerm_subnet.firewall: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/AzureFirewallSubnet]
module.networking.azurerm_subnet.gateway: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/GatewaySubnet]
module.spoke2.azurerm_subnet.workload: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload]
module.spoke1.azurerm_subnet.workload: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/subnets/snet-workload]
module.onprem_simulation.azurerm_subnet.server: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks/subnets/ServerSubnet]
module.workload_webapp_spoke2.azurerm_linux_web_app.app: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f]
azurerm_virtual_network_peering.spoke2_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/virtualNetworkPeerings/peer-spoke2-to-hub]
azurerm_virtual_network_peering.hub_to_spoke2: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-spoke2]
azurerm_virtual_network_peering.hub_to_spoke1: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-spoke1]
azurerm_virtual_network_peering.spoke1_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/virtualNetworkPeerings/peer-spoke1-to-hub]
azurerm_virtual_network_peering.hub_to_onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-onprem]
azurerm_virtual_network_peering.onprem_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks/virtualNetworkPeerings/peer-onprem-to-hub]
module.networking.azurerm_subnet_network_security_group_association.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/snet-agw-uks]
module.security.azurerm_firewall_policy_rule_collection_group.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/firewallPolicies/afwp-uks-premium/ruleCollectionGroups/fp-rcg-main]
module.spoke1.azurerm_subnet_network_security_group_association.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/subnets/snet-workload]
module.spoke2.azurerm_subnet_network_security_group_association.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload]
module.workload_vm_spoke1.azurerm_network_interface.vm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkInterfaces/nic-vm-spoke1]
module.security.azurerm_firewall.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium]
module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1]
module.security.azurerm_monitor_diagnostic_setting.fw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium|diag-fw-to-law]
module.workload_vm_spoke1.azurerm_virtual_machine_extension.nw_agent: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1/extensions/NetworkWatcherAgentWindows]
module.workload_vm_spoke1.azurerm_virtual_machine_extension.custom_script: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1/extensions/install-iis]
module.observability.azurerm_network_connection_monitor.cm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkWatchers/nw-uks/connectionMonitors/cm-connectivity-test]
module.workload_webapp_spoke2.azurerm_app_service_virtual_network_swift_connection.vnet_integration: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f/config/virtualNetwork]

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  ~ update in-place

Terraform planned the following actions, but then encountered a problem:

  # module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm will be updated in-place
  ~ resource "azurerm_windows_virtual_machine" "vm" {
        id                                                     = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1"
        name                                                   = "vm-spoke1"
        tags                                                   = {}
      ~ vm_agent_platform_updates_enabled                      = true -> false
        # (41 unchanged attributes hidden)

        # (2 unchanged blocks hidden)
    }

  # module.workload_webapp_spoke2.azurerm_linux_web_app.app will be updated in-place
  ~ resource "azurerm_linux_web_app" "app" {
        id                                             = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f"
        name                                           = "app-spoke2-obs-7e05e98f"
        tags                                           = {}
      - virtual_network_subnet_id                      = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload" -> null
        # (24 unchanged attributes hidden)

        # (1 unchanged block hidden)
    }

Plan: 0 to add, 2 to change, 0 to destroy.

Error: "backend_address_pool.0.ip_addresses.1" is not a valid IPv4 address: "app-spoke2-obs-7e05e98f.azurewebsites.net"

  with module.security.azurerm_application_gateway.main,
  on modules\security\main.tf line 51, in resource "azurerm_application_gateway" "main":
  51: resource "azurerm_application_gateway" "main" {


random_id.sa: Refreshing state... [id=fgXpjw]
azurerm_resource_group.hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks]
module.onprem_simulation.azurerm_resource_group.onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks]
module.onprem_simulation.azurerm_virtual_network.onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks]
module.spoke2.azurerm_network_security_group.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke2-uks]
module.security.azurerm_firewall_policy.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/firewallPolicies/afwp-uks-premium]
module.spoke2.azurerm_virtual_network.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks]
module.networking.azurerm_network_security_group.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-agw-uks]
module.networking.azurerm_virtual_network.hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks]
module.observability.azurerm_log_analytics_workspace.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f]
module.workload_webapp_spoke2.azurerm_service_plan.app: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/serverFarms/asp-app-spoke2-obs-7e05e98f]
module.security.azurerm_public_ip.agw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-agw-uks-7e05e98f]
module.security.azurerm_public_ip.fw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks]
module.spoke1.azurerm_virtual_network.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks]
module.observability.azurerm_network_watcher.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkWatchers/nw-uks]
module.spoke1.azurerm_network_security_group.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke1-uks]
module.observability.azurerm_storage_account.flowlogs: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Storage/storageAccounts/stflowlogs7e05e98f]
module.networking.azurerm_subnet.firewall: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/AzureFirewallSubnet]
module.networking.azurerm_subnet.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/snet-agw-uks]
module.networking.azurerm_subnet.gateway: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/GatewaySubnet]
module.spoke2.azurerm_subnet.workload: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload]
module.security.azurerm_firewall_policy_rule_collection_group.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/firewallPolicies/afwp-uks-premium/ruleCollectionGroups/fp-rcg-main]
module.onprem_simulation.azurerm_subnet.server: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks/subnets/ServerSubnet]
azurerm_virtual_network_peering.spoke2_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/virtualNetworkPeerings/peer-spoke2-to-hub]
module.spoke1.azurerm_subnet.workload: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/subnets/snet-workload]
azurerm_virtual_network_peering.hub_to_spoke2: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-spoke2]
azurerm_virtual_network_peering.hub_to_onprem: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-onprem]
azurerm_virtual_network_peering.onprem_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-onprem-sim-uks/providers/Microsoft.Network/virtualNetworks/vnet-onprem-uks/virtualNetworkPeerings/peer-onprem-to-hub]
module.workload_webapp_spoke2.azurerm_linux_web_app.app: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f]
azurerm_virtual_network_peering.hub_to_spoke1: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/virtualNetworkPeerings/peer-hub-to-spoke1]
azurerm_virtual_network_peering.spoke1_to_hub: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/virtualNetworkPeerings/peer-spoke1-to-hub]
module.spoke2.azurerm_subnet_network_security_group_association.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload]
module.networking.azurerm_subnet_network_security_group_association.waf: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/snet-agw-uks]
module.spoke1.azurerm_subnet_network_security_group_association.spoke: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke1-uks/subnets/snet-workload]
module.workload_vm_spoke1.azurerm_network_interface.vm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkInterfaces/nic-vm-spoke1]
module.security.azurerm_firewall.main: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium]
module.security.azurerm_monitor_diagnostic_setting.fw: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium|diag-fw-to-law]
module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1]
module.workload_vm_spoke1.azurerm_virtual_machine_extension.custom_script: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1/extensions/install-iis]
module.observability.azurerm_network_connection_monitor.cm: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkWatchers/nw-uks/connectionMonitors/cm-connectivity-test]
module.workload_vm_spoke1.azurerm_virtual_machine_extension.nw_agent: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1/extensions/NetworkWatcherAgentWindows]
module.workload_webapp_spoke2.azurerm_app_service_virtual_network_swift_connection.vnet_integration: Refreshing state... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f/config/virtualNetwork]

Terraform used the selected providers to generate the following execution
plan. Resource actions are indicated with the following symbols:
  + create
  ~ update in-place
-/+ destroy and then create replacement

Terraform will perform the following actions:

  # azurerm_network_watcher_flow_log.spoke1 will be created
  + resource "azurerm_network_watcher_flow_log" "spoke1" {
      + enabled                   = true
      + id                        = (known after apply)
      + location                  = (known after apply)
      + name                      = "flowlog-spoke1"
      + network_security_group_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke1-uks"
      + network_watcher_name      = "nw-uks"
      + resource_group_name       = "rg-net-observability-uks"
      + storage_account_id        = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Storage/storageAccounts/stflowlogs7e05e98f"
      + version                   = (known after apply)

      + retention_policy {
          + days    = 7
          + enabled = true
        }

      + traffic_analytics {
          + enabled               = true
          + interval_in_minutes   = 10
          + workspace_id          = "17d8e80a-fa0e-4fe6-b5d9-74697b9516ac"
          + workspace_region      = "uksouth"
          + workspace_resource_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f"
        }
    }

  # azurerm_network_watcher_flow_log.spoke2 will be created
  + resource "azurerm_network_watcher_flow_log" "spoke2" {
      + enabled                   = true
      + id                        = (known after apply)
      + location                  = (known after apply)
      + name                      = "flowlog-spoke2"
      + network_security_group_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-vnet-spoke2-uks"
      + network_watcher_name      = "nw-uks"
      + resource_group_name       = "rg-net-observability-uks"
      + storage_account_id        = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Storage/storageAccounts/stflowlogs7e05e98f"
      + version                   = (known after apply)

      + retention_policy {
          + days    = 7
          + enabled = true
        }

      + traffic_analytics {
          + enabled               = true
          + interval_in_minutes   = 10
          + workspace_id          = "17d8e80a-fa0e-4fe6-b5d9-74697b9516ac"
          + workspace_region      = "uksouth"
          + workspace_resource_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f"
        }
    }

  # module.observability.azurerm_network_watcher_flow_log.waf will be created
  + resource "azurerm_network_watcher_flow_log" "waf" {
      + enabled                   = true
      + id                        = (known after apply)
      + location                  = (known after apply)
      + name                      = "flowlog-agw-uks"
      + network_security_group_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/networkSecurityGroups/nsg-agw-uks"
      + network_watcher_name      = "nw-uks"
      + resource_group_name       = "rg-net-observability-uks"
      + storage_account_id        = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Storage/storageAccounts/stflowlogs7e05e98f"
      + version                   = (known after apply)

      + retention_policy {
          + days    = 7
          + enabled = true
        }

      + traffic_analytics {
          + enabled               = true
          + interval_in_minutes   = 10
          + workspace_id          = "17d8e80a-fa0e-4fe6-b5d9-74697b9516ac"
          + workspace_region      = "uksouth"
          + workspace_resource_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f"
        }
    }

  # module.security.azurerm_application_gateway.main will be created
  + resource "azurerm_application_gateway" "main" {
      + id                          = (known after apply)
      + location                    = "uksouth"
      + name                        = "agw-uks-waf-7e05e98f"
      + private_endpoint_connection = (known after apply)
      + resource_group_name         = "rg-net-observability-uks"

      + backend_address_pool {
          + fqdns        = []
          + id           = (known after apply)
          + ip_addresses = []
          + name         = "my-backend-pool"
        }

      + backend_http_settings {
          + cookie_based_affinity               = "Disabled"
          + id                                  = (known after apply)
          + name                                = "my-http-settings"
          + path                                = "/path1/"
          + pick_host_name_from_backend_address = false
          + port                                = 80
          + probe_id                            = (known after apply)
          + protocol                            = "Http"
          + request_timeout                     = 60
          + trusted_root_certificate_names      = []
            # (3 unchanged attributes hidden)
        }

      + frontend_ip_configuration {
          + id                            = (known after apply)
          + name                          = "my-frontend-ip-configuration"
          + private_ip_address            = (known after apply)
          + private_ip_address_allocation = "Dynamic"
          + private_link_configuration_id = (known after apply)
          + public_ip_address_id          = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-agw-uks-7e05e98f"
        }

      + frontend_port {
          + id   = (known after apply)
          + name = "port_80"
          + port = 80
        }

      + gateway_ip_configuration {
          + id        = (known after apply)
          + name      = "my-gateway-ip-configuration"
          + subnet_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-hub-uks/subnets/snet-agw-uks"
        }

      + http_listener {
          + frontend_ip_configuration_id   = (known after apply)
          + frontend_ip_configuration_name = "my-frontend-ip-configuration"
          + frontend_port_id               = (known after apply)
          + frontend_port_name             = "port_80"
          + host_names                     = []
          + id                             = (known after apply)
          + name                           = "my-listener"
          + protocol                       = "Http"
          + ssl_certificate_id             = (known after apply)
          + ssl_profile_id                 = (known after apply)
            # (4 unchanged attributes hidden)
        }

      + request_routing_rule {
          + backend_address_pool_id     = (known after apply)
          + backend_address_pool_name   = "my-backend-pool"
          + backend_http_settings_id    = (known after apply)
          + backend_http_settings_name  = "my-http-settings"
          + http_listener_id            = (known after apply)
          + http_listener_name          = "my-listener"
          + id                          = (known after apply)
          + name                        = "my-routing-rule"
          + priority                    = 1
          + redirect_configuration_id   = (known after apply)
          + rewrite_rule_set_id         = (known after apply)
          + rule_type                   = "Basic"
          + url_path_map_id             = (known after apply)
            # (3 unchanged attributes hidden)
        }

      + sku {
          + capacity = 1
          + name     = "WAF_v2"
          + tier     = "WAF_v2"
        }

      + ssl_policy (known after apply)

      + waf_configuration {
          + enabled                  = true
          + file_upload_limit_mb     = 100
          + firewall_mode            = "Prevention"
          + max_request_body_size_kb = 128
          + request_body_check       = true
          + rule_set_type            = "OWASP"
          + rule_set_version         = "3.2"
        }
    }

  # module.security.azurerm_firewall.main will be updated in-place
  ~ resource "azurerm_firewall" "main" {
        id                  = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium"
        name                = "afw-uks-premium"
        tags                = {}
        # (10 unchanged attributes hidden)

      ~ ip_configuration {
            name                 = "configuration"
          ~ public_ip_address_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks" -> (known after apply)
            # (2 unchanged attributes hidden)
        }
    }

  # module.security.azurerm_monitor_diagnostic_setting.fw will be updated in-place
  ~ resource "azurerm_monitor_diagnostic_setting" "fw" {
        id                             = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium|diag-fw-to-law"
      ~ log_analytics_workspace_id     = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-observability-uks" -> "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.OperationalInsights/workspaces/law-net-obs-uks-7e05e98f"
        name                           = "diag-fw-to-law"
        # (4 unchanged attributes hidden)

        # (19 unchanged blocks hidden)
    }

  # module.security.azurerm_public_ip.fw must be replaced
-/+ resource "azurerm_public_ip" "fw" {
      + fqdn                    = (known after apply)
      ~ id                      = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks" -> (known after apply)
      ~ ip_address              = "20.108.186.145" -> (known after apply)
      - ip_tags                 = {} -> null
      ~ name                    = "pip-fw-uks" -> "pip-fw-uks-7e05e98f" # forces replacement
      - tags                    = {} -> null
      - zones                   = [] -> null
        # (9 unchanged attributes hidden)
    }

  # module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm will be updated in-place
  ~ resource "azurerm_windows_virtual_machine" "vm" {
        id                                                     = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1"
        name                                                   = "vm-spoke1"
        tags                                                   = {}
      ~ vm_agent_platform_updates_enabled                      = true -> false
        # (41 unchanged attributes hidden)

        # (2 unchanged blocks hidden)
    }

  # module.workload_webapp_spoke2.azurerm_app_service_virtual_network_swift_connection.vnet_integration will be created
  + resource "azurerm_app_service_virtual_network_swift_connection" "vnet_integration" {
      + app_service_id = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f"
      + id             = (known after apply)
      + subnet_id      = "/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/virtualNetworks/vnet-spoke2-uks/subnets/snet-workload"
    }

Plan: 6 to add, 3 to change, 1 to destroy.
module.security.azurerm_public_ip.fw: Destroying... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks]
module.workload_webapp_spoke2.azurerm_app_service_virtual_network_swift_connection.vnet_integration: Creating...
azurerm_network_watcher_flow_log.spoke1: Creating...
module.observability.azurerm_network_watcher_flow_log.waf: Creating...
module.security.azurerm_application_gateway.main: Creating...
module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm: Modifying... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1]
azurerm_network_watcher_flow_log.spoke2: Creating...
module.workload_webapp_spoke2.azurerm_app_service_virtual_network_swift_connection.vnet_integration: Creation complete after 10s [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Web/sites/app-spoke2-obs-7e05e98f/config/virtualNetwork]
module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm: Still modifying... [id=/subscriptions/87cf2b93-5e52-4533-9e6b-...soft.Compute/virtualMachines/vm-spoke1, 00m10s elapsed]
module.workload_vm_spoke1.azurerm_windows_virtual_machine.vm: Modifications complete after 16s [id=/subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Compute/virtualMachines/vm-spoke1]

Error: deleting Public I P Address (Subscription: "87cf2b93-5e52-4533-9e6b-7182cd7dbde6"
Resource Group Name: "rg-net-observability-uks"
Public I P Addresses Name: "pip-fw-uks"): performing Delete: unexpected status 400 (400 Bad Request) with error: PublicIPAddressCannotBeDeleted: Public IP address /subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/publicIPAddresses/pip-fw-uks can not be deleted since it is still allocated to resource /subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/azureFirewalls/afw-uks-premium/azureFirewallIpConfigurations/configuration. In order to delete the public IP, disassociate/detach the Public IP address from the resource.  To learn how to do this, see aka.ms/deletepublicip.


Error: creating Flow Log (Subscription: "87cf2b93-5e52-4533-9e6b-7182cd7dbde6"
Resource Group Name: "rg-net-observability-uks"
Network Watcher Name: "nw-uks"
Flow Log Name: "flowlog-spoke1"): performing CreateOrUpdate: unexpected status 400 (400 Bad Request) with error: NsgFlowLogCreationBlocked: On September 30, 2027, Network Security Group (NSG) flow logs will be retired. As part of this retirement, creation of new NSG flow logs is blocked starting June 30, 2025, but you will be able to continue using and modifying settings for existing NSG flow logs that are previously deployed/configured until Sept 30th 2027. We recommend migrating to virtual network flow logs, which overcome the limitations of NSG flow logs. For migration, please refer to https://learn.microsoft.com/en-us/azure/network-watcher/nsg-flow-logs-migrate.

  with azurerm_network_watcher_flow_log.spoke1,
  on main.tf line 90, in resource "azurerm_network_watcher_flow_log" "spoke1":
  90: resource "azurerm_network_watcher_flow_log" "spoke1" {


Error: creating Flow Log (Subscription: "87cf2b93-5e52-4533-9e6b-7182cd7dbde6"
Resource Group Name: "rg-net-observability-uks"
Network Watcher Name: "nw-uks"
Flow Log Name: "flowlog-spoke2"): performing CreateOrUpdate: unexpected status 400 (400 Bad Request) with error: NsgFlowLogCreationBlocked: On September 30, 2027, Network Security Group (NSG) flow logs will be retired. As part of this retirement, creation of new NSG flow logs is blocked starting June 30, 2025, but you will be able to continue using and modifying settings for existing NSG flow logs that are previously deployed/configured until Sept 30th 2027. We recommend migrating to virtual network flow logs, which overcome the limitations of NSG flow logs. For migration, please refer to https://learn.microsoft.com/en-us/azure/network-watcher/nsg-flow-logs-migrate.

  with azurerm_network_watcher_flow_log.spoke2,
  on main.tf line 111, in resource "azurerm_network_watcher_flow_log" "spoke2":
 111: resource "azurerm_network_watcher_flow_log" "spoke2" {


Error: creating Flow Log (Subscription: "87cf2b93-5e52-4533-9e6b-7182cd7dbde6"
Resource Group Name: "rg-net-observability-uks"
Network Watcher Name: "nw-uks"
Flow Log Name: "flowlog-agw-uks"): performing CreateOrUpdate: unexpected status 400 (400 Bad Request) with error: NsgFlowLogCreationBlocked: On September 30, 2027, Network Security Group (NSG) flow logs will be retired. As part of this retirement, creation of new NSG flow logs is blocked starting June 30, 2025, but you will be able to continue using and modifying settings for existing NSG flow logs that are previously deployed/configured until Sept 30th 2027. We recommend migrating to virtual network flow logs, which overcome the limitations of NSG flow logs. For migration, please refer to https://learn.microsoft.com/en-us/azure/network-watcher/nsg-flow-logs-migrate.

  with module.observability.azurerm_network_watcher_flow_log.waf,
  on modules\observability\main.tf line 26, in resource "azurerm_network_watcher_flow_log" "waf":
  26: resource "azurerm_network_watcher_flow_log" "waf" {


Error: creating Application Gateway (Subscription: "87cf2b93-5e52-4533-9e6b-7182cd7dbde6"
Resource Group Name: "rg-net-observability-uks"
Application Gateway Name: "agw-uks-waf-7e05e98f"): performing CreateOrUpdate: unexpected status 400 (400 Bad Request) with error: ApplicationGatewayDeprecatedTlsVersionUsedInSslPolicy: The TLS policy AppGwSslPolicy20150501 for Application Gateway /subscriptions/87cf2b93-5e52-4533-9e6b-7182cd7dbde6/resourceGroups/rg-net-observability-uks/providers/Microsoft.Network/applicationGateways/agw-uks-waf-7e05e98f is using a deprecated TLS version. Update it to a supported version. Learn more https://aka.ms/appgw-oldtlsversions

  with module.security.azurerm_application_gateway.main,
  on modules\security\main.tf line 51, in resource "azurerm_application_gateway" "main":
  51: resource "azurerm_application_gateway" "main" {

